Udfordringer
------------
Nogen gange kan man ikke bare bruge en standard shellcode.

Her følger et par eksempler på udfordinger.

Udfordringer - Shelly
---------------------
De er implementeret i programmet 'shelly' som ligger i 'assignments'.

[source,bash]
------------------------------------------------
$ strace ./assignments/shelly --debug --port 1337
....
listen(3, 10)                           = 0
getpid()                                = 5290
accept(3,
------------------------------------------------

Udfordringer - Shelly
---------------------
[source,bash]
------------------------------------------------
$ nc localhost 1337
Hello there. How may I help you?
Choose from the menu:
 1) Execute up to 256 bytes shellcode
 2) Trampoline can only execute few bytes
 3) Read pointers
 4) Write pointers
 5) Required constants
 6) Avoid certain chars
 7) Shellcode needs to be printable
 8) Try fitting a 10000 byte shellcode into 64 bytes
 9) Go egg hunting
10) Go stack hunting
11) Exit
------------------------------------------------

Udfordringer - 'ESP' + meget få bytes
-------------------------------------
[source,bash]
------------------------------------------------
 2) Trampoline can only execute few bytes
------------------------------------------------

Typisk for off-by-a-few bugs.
[source,c]
------------------------------------------------
include::../assignments/trampoline_few_bytes[]
------------------------------------------------

Udfordringer - 'ESP' + meget få bytes
-------------------------------------
Typisk for off-by-a-few bugs.

image:../images/off-by-a-few.png[]

Udfordringer - 'ESP' + meget få bytes
-------------------------------------
Typisk for off-by-a-few bugs.

image:../images/off-by-a-few-solution.png[]

Short jumps (+127/-128) kan gøres på to bytes, skal man længere fylder det fem bytes.

Udfordringer - Læste pointer
----------------------------
[source,bash]
------------------------------------------------
 3) Read pointers
------------------------------------------------
[source,c]
------------------------------------------------
include::../assignments/read_pointers[]
------------------------------------------------

Udfordringer - Læste pointer
----------------------------
image:../images/read_pointer.png[]

Udfordringer - Læste pointer
----------------------------
image:../images/read_pointer-solution.png[]

I en ikke position independent executable:
[source,bash]
------------------------------------------------
$ cat /proc/12708/maps | grep shelly
08048000-0804a000 r-xp 00000000 fc:01 3553329   ...
0804b000-0804c000 r-xp 00002000 fc:01 3553329   ...
0804c000-0804d000 rwxp 00003000 fc:01 3553329   ...
------------------------------------------------

Udfordringer - Skrevne pointere
-------------------------------
[source,bash]
------------------------------------------------
 4) Write pointers
------------------------------------------------
[source,c]
------------------------------------------------
include::../assignments/write_pointers[]
------------------------------------------------

Udfordringer - Skrevne pointere
-------------------------------
image:../images/write_pointer.png[]

Udfordringer - Skrevne pointere
-------------------------------
image:../images/write_pointer-solution.png[]

I en ikke position independent executable:
[source,bash]
------------------------------------------------
$ cat /proc/12708/maps | grep shelly
08048000-0804a000 r-xp 00000000 fc:01 3553329   ...
0804b000-0804c000 r-xp 00002000 fc:01 3553329   ...
0804c000-0804d000 rwxp 00003000 fc:01 3553329   ...
------------------------------------------------

Udfordringer - Krævede konstanter
---------------------------------
[source,bash]
------------------------------------------------
 5) Required constants
------------------------------------------------

[source,c]
------------------------------------------------
include::../assignments/required_constants[]
------------------------------------------------

Udfordringer - Krævede konstanter
---------------------------------
image:../images/required_constants-solution.png[width="800"]

Udfordringer - Filtre (bad chars)
---------------------------------
[source,c]
------------------------------------------------
include::../assignments/avoid_chars[]
------------------------------------------------

Udfordringer - Printable
------------------------
[source,c]
------------------------------------------------
include::../assignments/printable_shellcode[]
------------------------------------------------
